schema: '2.0'
stages:
  slide_download:
    cmd: python ../../../scripts/utils/file_transfer.py --data_path ../data --ihc_type
      CD3CD20 --mapping_file ../../../ihc_mapping.json --mask_extension .tif --remote_path
      /media/AprioricsSlides --slide_extension .svs --add_tree --import_file ../../../file_lists/cd3cd20
      --import_ihc --extension .svs --rel_path slides --remote_rel_path .
    outs:
    - path: ../data/slides
      hash: md5
      md5: b7aece06b3214c42267374f6797c831f.dir
      size: 273981404028
      nfiles: 160
  mask_extraction:
    cmd: python ../../../scripts/mask_extraction/register_extract_polygons_masks_mp.py
      --data_path ../data --ihc_type CD3CD20 --mapping_file ../../../ihc_mapping.json
      --mask_extension .tif --remote_path /media/AprioricsSlides --slide_extension
      .svs --binary_op closing --dab_thr 0.01 --nuc_max_size 24 --nuc_min_size 0 --num_workers
      30 --object_min_size 100 --radius 5 --geojson_path geojsons --hovernet_path
      hoverfast_gpkgs --log_path registration_geojsons --main_slide_path slides --slide_path
      slides_tmp --mask_path masks --tissue_path tissue_geojsons
    deps:
    - path: ../data/slides
      hash: md5
      md5: c1297e19ba3df40d65d970216df48e75.dir
      size: 479767631718
      nfiles: 314
    outs:
    - path: ../data/geojsons
      hash: md5
      md5: 7a99d4713fa33ea80bb044c7993ef141.dir
      size: 5798799469
      nfiles: 150
    - path: ../data/masks
      hash: md5
      md5: 13287e11a7cbd234eb7e5a43c44657f7.dir
      size: 101792895342
      nfiles: 150
    - path: ../data/registration_geojsons
      hash: md5
      md5: fcc44aa463a04d851d90b4b84afed308.dir
      size: 1106959
      nfiles: 157
  geojson_upload:
    cmd: rsync -au ../data/geojsons /media/AprioricsSlides/geojsons/CD3CD20
    deps:
    - path: ../data/geojsons
      hash: md5
      md5: 96d0246564081c1e64981a0cc9d2e7b6.dir
      size: 5903768940
      nfiles: 155
