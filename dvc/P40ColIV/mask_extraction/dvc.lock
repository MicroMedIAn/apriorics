schema: '2.0'
stages:
  slide_download:
    cmd: python ../../../scripts/utils/file_transfer.py --data_path ../data --ihc_type
      P40ColIV --mapping_file ../../../ihc_mapping.json --mask_extension .tif --remote_path
      /media/AprioricsSlides --slide_extension .svs --add_tree --clean_previous --import_file
      ../../../file_lists/P40ColIV --import_ihc --extension .svs --rel_path slides
      --remote_rel_path .
    outs:
    - path: ../data/slides
      hash: md5
      md5: 0494abbc20a44c25f15ca37d225bb8fd.dir
      size: 13578166730
      nfiles: 8
  mask_extraction:
    cmd: python ../../../scripts/mask_extraction/register_extract_polygons_masks_mp.py
      --data_path /data/anapath/AprioricsSlides --ihc_type P40ColIV --mapping_file
      ../../../ihc_mapping.json --mask_extension .tif --remote_path /media/AprioricsSlides
      --slide_extension .svs --dab_thr 0.015 --object_min-size 50 --binary_op none
      --num_workers 20 --iou_thr 0.05 --nuc_max_siz 40 --mask_path masks --main_slide_path
      slides --slide_path slides_tmp --geojson_path geojsons --log_path registration_geojsons
      --hovernet_path hovernet_gpkgs
    deps:
    - path: .downloaded_slides.csv
      md5: 82005b91aae828cc9ae1ecdd5bdddc6d
      size: 706
    outs:
    - path: /data/anapath/AprioricsSlides/geojsons/P40ColIV
      md5: 77ac47b3ea1f04538ab9963a174e9464.dir
      size: 38998311
      nfiles: 4
    - path: /data/anapath/AprioricsSlides/masks/P40ColIV
      md5: df0041354107844edc704545e387967c.dir
      size: 2224333104
      nfiles: 4
    - path: /data/anapath/AprioricsSlides/registration_geojsons/P40ColIV
      md5: 838a63c0ceb8113021fd8a360f544b29.dir
      size: 32122
      nfiles: 4
  geojson_upload:
    cmd: rsync -au ../data/geojsons /media/AprioricsSlides/geojsons/P40ColIV
    deps:
    - path: ../data/geojsons
      hash: md5
      md5: a18c9d52607a43033888e726adf75234.dir
      size: 38998311
      nfiles: 4
