schema: '2.0'
stages:
  slide_download:
    cmd: python ../../../scripts/utils/file_transfer.py --data_path ../data --ihc_type
      AE1AE3 --mapping_file ../../../ihc_mapping.json --mask_extension .tif --remote_path
      /media/AprioricsSlides/ --slide_extension .svs --add_tree --clean_previous --import_ihc
      --extension .svs --rel_path slides --remote_rel_path .
    outs:
    - path: ../data/slides
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
  mask_extraction:
    cmd: python ../../../scripts/mask_extraction/register_extract_polygons_masks_mp.py
      --data_path ../data --ihc_type AE1AE3 --mapping_file ../../../ihc_mapping.json
      --mask_extension .tif --remote_path /media/AprioricsSlides/ --slide_extension
      .svs --binary_op closing --dab_thr 0.03 --object_min_size 1000 --overlap 0.3
      --psize 2000 --radius 10 --geojson_path geojsons --hovernet_path hovernet_gpkgs
      --log_path registration_geojsons --slide_path slides --mask_path masks --wkt_path
      wkts
    deps:
    - path: ../data/slides
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
    outs:
    - path: ../data/geojsons
      hash: md5
      md5: 24df5d8de42d67d0ecfbdb843f2fe3e0.dir
      size: 21441828907
      nfiles: 545
    - path: ../data/masks
      hash: md5
      md5: 9c923b617991c71debb57c3f136ad5be.dir
      size: 547157558083
      nfiles: 546
    - path: ../data/registration_geojsons
      hash: md5
      md5: d751713988987e9331980363e24189ce.dir
      size: 0
      nfiles: 0
  geojson_upload:
    cmd: rsync -au ../data/geojsons /media/AprioricsSlides//geojsons/AE1AE3
    deps:
    - path: ../data/geojsons
      hash: md5
      md5: 24df5d8de42d67d0ecfbdb843f2fe3e0.dir
      size: 21441828907
      nfiles: 545
