schema: '2.0'
stages:
  slide_download:
    cmd: python ../utils/file_transfer.py --out-csv .downloaded_slides.csv --data-path
      '/data/anapath/AprioricsSlides' --ihc-type 'PHH3' --mapping-file '../../ihc_mapping.json'
      --mask-extension '.tif' --remote-path '/media/AprioricsSlides' --slide-extension
      '.svs' --slide-path 'slides' --clean-previous --import-ihc --extension .svs
      --rel-path slides --remote-rel-path .
    outs:
    - path: .downloaded_slides.csv
      md5: 660225c7236a628c1e954a7d8c781809
      size: 129331
  mask_extraction:
    cmd: python register_extract_polygons_masks_mp.py --data-path '/data/anapath/AprioricsSlides'
      --ihc-type 'PHH3' --mapping-file '../../ihc_mapping.json' --mask-extension '.tif'
      --remote-path '/media/AprioricsSlides' --slide-extension '.svs' --dab-thr 0.04
      --object-min-size 50 --binary-op 'none' --mask-path 'masks' --slide-path 'slides'
      --wkt-path 'wkts' --geojson-path 'geojsons'
    deps:
    - path: .downloaded_slides.csv
      md5: 660225c7236a628c1e954a7d8c781809
      size: 129331
    outs:
    - path: /data/anapath/AprioricsSlides/masks/PHH3
      md5: 951222c874246fb4382aab3e2a054872.dir
      size: 193781204068
      nfiles: 386
    - path: /data/anapath/AprioricsSlides/wkts/PHH3
      md5: 8775649ffc2b204535fbd89688b8358e.dir
      size: 18779938
      nfiles: 386
  wkt_to_geojson:
    cmd: python ../utils/wkt2geojsons.py --mask-path 'masks' --slide-path 'slides'
      --wkt-path 'wkts' --geojson-path 'geojsons' --data-path /data/anapath/AprioricsSlides
      --ihc-type PHH3
    deps:
    - path: /data/anapath/AprioricsSlides/wkts/PHH3
      md5: 8775649ffc2b204535fbd89688b8358e.dir
      size: 18779938
      nfiles: 386
    outs:
    - path: /data/anapath/AprioricsSlides/geojsons/PHH3
      md5: 4076d5bf1fce32b8c8d3c97bcc170507.dir
      size: 41654200
      nfiles: 386
  geojson_upload:
    cmd: python ../utils/file_transfer.py --data-path /media/AprioricsSlides --remote-path
      /data/anapath/AprioricsSlides --ihc-type PHH3 --mapping-file ../../ihc_mapping.json
      --recurse --extension .geojson --rel-path geojsons --remote-rel-path geojsons
    deps:
    - path: /data/anapath/AprioricsSlides/geojsons/PHH3
      md5: 4076d5bf1fce32b8c8d3c97bcc170507.dir
      size: 41654200
      nfiles: 386
  mask_upload:
    cmd: python ../utils/file_transfer.py --data-path /media/AprioricsSlides --remote-path
      /data/anapath/AprioricsSlides --ihc-type PHH3 --mapping-file ../../ihc_mapping.json
      --recurse --extension .tif --rel-path masks --remote-rel-path masks
    deps:
    - path: /data/anapath/AprioricsSlides/masks/PHH3
      md5: 951222c874246fb4382aab3e2a054872.dir
      size: 193781204068
      nfiles: 386
