schema: '2.0'
stages:
  slide_download:
    cmd: python ../utils/file_transfer.py --out-csv .downloaded_slides.csv --data-path
      '/data/anapath/AprioricsSlides' --ihc-type 'PHH3' --mapping-file '../../ihc_mapping.json'
      --mask-extension '.tif' --remote-path '/media/AprioricsSlides' --slide-extension
      '.svs' --clean-previous --import-ihc --extension .svs --rel-path slides --remote-rel-path
      .
    outs:
    - path: .downloaded_slides.csv
      md5: a9cd34b77800068fa1ad8eff1ce98fb9
      size: 134370
  mask_extraction:
    cmd: python register_extract_polygons_masks_mp.py --data_path /data/anapath/AprioricsSlides
      --ihc_type ERGPodoplanine --mapping_file ../../ihc_mapping.json --mask_extension
      .tif --remote_path /media/AprioricsSlides --slide_extension .svs --dab_thr 0.015
      --object_min-size 50 --binary_op none --num_workers 20 --mask_path masks --slide_path
      slides --wkt_path wkts --geojson_path geojsons
    deps:
    - path: .downloaded_slides.csv
      md5: a9cd34b77800068fa1ad8eff1ce98fb9
      size: 134370
    outs:
    - path: /data/anapath/AprioricsSlides/masks/ERGPodoplanine
      md5: fda40013719f400a9d727f06211bed56.dir
      size: 4078055578
      nfiles: 6
    - path: /data/anapath/AprioricsSlides/wkts/ERGPodoplanine
      md5: a79f0fd44666c8535180799abb3c061a.dir
      size: 128262210
      nfiles: 6
  wkt_to_geojson:
    cmd: python ../utils/wkt2geojsons.py --mask_path masks --slide_path slides --wkt_path
      wkts --geojson_path geojsons --data_path /data/anapath/AprioricsSlides --ihc_type
      ERGPodoplanine
    deps:
    - path: /data/anapath/AprioricsSlides/wkts/ERGPodoplanine
      md5: a79f0fd44666c8535180799abb3c061a.dir
      size: 128262210
      nfiles: 6
    outs:
    - path: /data/anapath/AprioricsSlides/geojsons/ERGPodoplanine
      md5: 1dec6e62a62fb66f381d468456cf0ee9.dir
      size: 218340605
      nfiles: 6
  geojson_upload:
    cmd: python ../utils/file_transfer.py --data_path /media/AprioricsSlides --remote_path
      /data/anapath/AprioricsSlides --ihc_type ERGPodoplanine --mapping_file ../../ihc_mapping.json
      --recurse --extension .geojson --rel_path geojsons --remote_rel_path geojsons
      --add_tree
    deps:
    - path: /data/anapath/AprioricsSlides/geojsons/ERGPodoplanine
      md5: 1dec6e62a62fb66f381d468456cf0ee9.dir
      size: 218340605
      nfiles: 6
  mask_upload:
    cmd: python ../utils/file_transfer.py --data-path /media/AprioricsSlides --remote-path
      /data/anapath/AprioricsSlides --ihc-type PHH3 --mapping-file ../../ihc_mapping.json
      --recurse --extension .tif --rel-path masks --remote-rel-path masks
    deps:
    - path: /data/anapath/AprioricsSlides/masks/PHH3
      md5: 951222c874246fb4382aab3e2a054872.dir
      size: 193781204068
      nfiles: 386
