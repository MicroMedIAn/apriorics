schema: '2.0'
stages:
  create_registry:
    cmd: python scripts/utils/update_slide_registry.py data/registry_slide.db --data-path
      /data/anapath/AprioricsSlides/. --extension .svs --mapping-file ihc_mapping.json
    outs:
    - path: data/registry_slide.db
      md5: ec33354b5efe738405bfbfe6c213d955
      size: 1855488
  slide_transfer:
    cmd: python scripts/utils/file_transfer.py data/srlbdgpu02_slide.db data/registry_slide.db
      --table slides --data-path '/data/anapath/apriorics' --ihc-type 'AE1AE3' --mapping-file
      'ihc_mapping.json' --mask-extension '.tif' --remote-path '/data/anapath/AprioricsSlides'
      --server 'srlbdgpu02' --slide-extension '.svs' --slide-path 'slides' --clean-previous
      --import-ihc --extension .svs --rel-path slides --remote-rel-path .
    deps:
    - path: data/registry_slide.db
      md5: ec33354b5efe738405bfbfe6c213d955
      size: 1855488
    outs:
    - path: data/srlbdgpu02_slide.db
      md5: d345068cb90374460c143b9267269f9e
      size: 212992
  slide_download:
    cmd: python scripts/utils/file_transfer.py data/srlbdgpu02_slide.db data/registry_slide.db
      data/registry_slide.db --table slides --data-path '/data/anapath/apriorics'
      --ihc-type 'AE1AE3' --mapping-file 'ihc_mapping.json' --mask-extension '.tif'
      --remote-path '/data/anapath/AprioricsSlides' --server 'srlbdgpu02' --slide-extension
      '.svs' --slide-path 'slides' --clean-previous --import-ihc --extension .svs
      --rel-path slides --remote-rel-path .
    deps:
    - path: data/registry_slide.db
      md5: ec33354b5efe738405bfbfe6c213d955
      size: 1855488
    outs:
    - path: data/srlbdgpu02_slide.db
      md5: d345068cb90374460c143b9267269f9e
      size: 212992
  mask_extraction:
    cmd: python scripts/mask_extraction/register_extract_polygons_masks_mp.py  data/srlbdgpu02_slide.db
      data/srlbdgpu02_mask.db data/srlbdgpu02_wkt.db --data-path '/data/anapath/apriorics'
      --ihc-type 'AE1AE3' --mapping-file 'ihc_mapping.json' --mask-extension '.tif'
      --remote-path '/data/anapath/AprioricsSlides' --server 'srlbdgpu02' --slide-extension
      '.svs' --slide-path 'slides' --psize 5000 --overlap 0.3 --crop 0.1 --dab-thr
      0.03 --object-min-size 1000 --binary-op 'closing' --radius 10 --mask-path 'masks'
      --slide-path 'slides' --wkt-path 'wkts' --geojson-path 'geojsons'
    deps:
    - path: data/srlbdgpu02_slide.db
      md5: d37d836dfb55ed56cf1a5abfd0d9d4de
      size: 16384
    outs:
    - path: data/srlbdgpu02_mask.db
      md5: 260114f3002f9ca82cfe64640aa5bdd7
      size: 16384
    - path: data/srlbdgpu02_wkt.db
      md5: 5544d0c348c9054068d91d679d238c1d
      size: 16384
  wkt_to_geojson:
    cmd: python scripts/utils/wkt2geojsons.py data/srlbdgpu02_wkt.db data/srlbdgpu02_geojson.db
      --mask-path 'masks' --slide-path 'slides' --wkt-path 'wkts' --geojson-path 'geojsons'
      --data-path /data/anapath/apriorics
    deps:
    - path: data/srlbdgpu02_wkt.db
      md5: 5544d0c348c9054068d91d679d238c1d
      size: 16384
    outs:
    - path: data/srlbdgpu02_geojson.db
      md5: 099707a0b1f66e3e0922d9318c8971da
      size: 16384
